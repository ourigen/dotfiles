# Read `man 5 sway` for a complete reference.

font pango:Iosevka Nerd Font Mono 10

set {
	# Theme
	$white #c0caf5
	$black #24283b
	$gray #414868
	$red #f7768e
	$green #9ece6a
	$cyan #7dcfff
	$yellow #e0af68
	$blue #7aa2f7
	$magenta #bb9af7

	# Mod4 = Super, Mod1 = Meta/Alt
	$mod Mod4
	$left h
	$down j
	$up k
	$right l

	$term alacritty

	$inner_gaps 3
	$outer_gaps 5

	$laptop eDP-1
	$monitor HDMI-A-2
}

gaps {
	inner $inner_gaps
	outer $outer_gaps
}

# OUTPUT
# swaymsg -t get_outputs

output * background $HOME/pictures/wallpapers/tokyonight/tokyonight-topography.jpg fill

output $laptop {
	resolution 1920x1080
	position 0,1080
}

output $monitor {
	resolution 1920x1080
	position 0,0
}

workspace {
	1 output $laptop
	2 output $laptop
	3 output $laptop
	4 output $laptop
	5 output $laptop

	6 output $monitor
	7 output $monitor
	8 output $monitor
	9 output $monitor
}

# INPUT
# See man sway-input (5) for details
# swaymsg -t get_inputs

input "2:7:SynPS/2_Synaptics_TouchPad" {
	tap enabled
	drag enabled
	natural_scroll enabled
	pointer_accel 0.50
	# scroll_factor 1.5
}
input "2:10:TPPS/2_IBM_TrackPoint" {
	pointer_accel 0.75
	# Disable-while-typing
	dwt enabled
}
# controlled by caps2esc
# remember to systemctl enable --now udevmon.service
input "1:1:AT_Translated_Set_2_keyboard" {
	# https://www.mankier.com/7/xkeyboard-config
	xkb_options ctrl:nocaps
}

input "9580:110:HUION_420" {
	map_to_output $laptop
	tool_mode * relative
	# map_from_region 0.22x0.22 0.78x0.78
}

# Specific window rules for apps
# app_id are specific to Wayland
# class are specific to X11

for_window {
	[app_id="firefox" title="^Picture-in-Picture$"] floating enable, resize set 480px 270px, move position 1420px 768px, sticky enable
	[app_id="firefox" title="^Firefox — Sharing Indicator$"] floating enable, no_focus, move position -1920px -1080px
	[app_id="udiskie"] floating enable; resize set 480px 270px; move position center
	# If an app is fullscreen, don't lock when idle
	[class="^.*"] inhibit_idle fullscreen
	[app_id="^.*"] inhibit_idle fullscreen
	# Popup scratchpad
	[app_id="popup"] floating enable; sticky enable; resize set 750px 500px; move scratchpad; scratchpad show; move position center
}

# Read `man 5 sway-bar` for more information about this section
bar swaybar_command waybar

# borders only displayed if gaps = 0 and workspace has more than one child
# smart_borders no_gaps
# smart_gaps on

# Window borders
default_border pixel 1
default_floating_border none
titlebar_border_thickness 0
title_align center

# Colorscheme
# class                 $border     $backgr.    $text   $indicator  $child_border
client.focused          $white       $black      $white  $white      $white
client.focused_inactive $black       $black      $white  $gray      $gray
client.unfocused        $black       $black      $white  $gray      $gray
client.urgent           $yellow      $black      $white  $red        $red

# border: The border around the title bar.
# background: The background of the title bar.
# text: The text color of the title bar.
# indicator: The color used to indicate where a new view will open. In a tiled container, this would paint the right border of the current view if a new view would be opened to the right.
# child_border: The border around the view itself.

# https://github.com/swaywm/sway/wiki/GTK-3-settings-on-Wayland
# set $gnome-schema org.gnome.desktop.interface
exec_always {
	gsettings set $gnome-schema gtk-theme 'Qogir-dark'
	gsettings set $gnome-schema font-name 'Iosevka Nerd Font Mono 10'
}

# BINDINGS {{{

bindsym $mod+q kill
bindsym $mod+Shift+c reload

# Hotkeys
bindsym $mod+Return exec $term
# Note: pass the final command to swaymsg so that the resulting window can be opened on the original workspace that the command was run on.
bindsym $mod+space exec wofi --show run | xargs swaymsg exec --
bindsym $mod+w exec firefox
bindsym $mod+n exec $term -e nnn
bindsym $mod+m exec $term -e ncmpcpp
# Quick terminal
bindsym $mod+Shift+space exec $term --class "popup"

bindsym $mod+bracketleft exec webmenu
bindsym $mod+bracketright exec helpmenu
bindsym $mod+p exec filemenu
bindsym $mod+backslash exec killmenu
# Alt-tab to switch window focus
# Mod1+Tab exec bemenu-window_select

bindsym Print exec "grimshot --notify save area $HOME/pictures/screenshots/screen-$(date +'%Y-%m-%d_%H%M%S').png"
bindsym Shift+Print exec sway-recorder

# use --locked so the keys can be accessed while sway is locked

# barify version with display bar
bindsym --locked XF86MonBrightnessUp exec barify brightness up
bindsym --locked XF86MonBrightnessDown exec barify brightness down
bindsym --locked XF86AudioRaiseVolume exec barify volume up
bindsym --locked XF86AudioLowerVolume exec barify volume down

# not using barify for muting since Thinkpads have light indicators anyways
bindsym --locked XF86AudioMute exec pactl set-sink-mute @DEFAULT_SINK@ toggle
bindsym --locked XF86AudioMicMute exec pactl set-source-mute @DEFAULT_SOURCE@ toggle

bindsym --locked XF86AudioNext exec mpc next
bindsym --locked XF86AudioPrev exec mpc prev
bindsym --locked XF86AudioPause exec mpc pause
bindsym --locked XF86AudioPlay exec mpc play

bindsym --locked $mod+Shift+backslash exec mpc toggle
bindsym --locked $mod+Shift+bracketleft exec mpc prev
bindsym --locked $mod+Shift+bracketright exec mpc next

# Disable laptop screen when lid is closed
bindswitch --reload --locked lid:on output $laptop disable
bindswitch --reload --locked lid:off output $laptop enable
# }}}

# LAYOUTS {{{
# Drag floating windows by holding down $mod and left mouse button.
# Resize them with right mouse button + $mod.
# also works for non-floating windows.
# Change normal to inverse to use left mouse button for resizing and right
# mouse button for dragging.
floating_modifier $mod normal

# Toggle the current focus between tiling and floating mode
bindsym $mod+f floating toggle
# Swap focus between the tiling area and the floating area
bindsym $mod+Shift+f focus mode_toggle

# Move your focus around
bindsym $mod+$left focus left
bindsym $mod+$down focus down
bindsym $mod+$up focus up
bindsym $mod+$right focus right

# Move the focused window
bindsym $mod+Shift+$left move left
bindsym $mod+Shift+$down move down
bindsym $mod+Shift+$up move up
bindsym $mod+Shift+$right move right

# Resizing containers:
bindsym $mod+Ctrl+$left resize shrink width 25px
bindsym $mod+Ctrl+$right resize grow width 25px
bindsym $mod+Ctrl+$up resize grow height 10px
bindsym $mod+Ctrl+$down resize shrink height 10px

# Resizing gaps
bindsym $mod+Ctrl+m gaps inner all set 0,gaps outer all set 0
bindsym $mod+Ctrl+n gaps inner all set $inner_gaps,gaps outer all set $outer_gaps
bindsym $mod+Ctrl+z gaps inner all plus $inner_gaps,gaps outer all plus $outer_gaps
bindsym $mod+Ctrl+x gaps inner all minus $inner_gaps,gaps outer all minus $outer_gaps

# Cycle between horizontal and vertical split layout
bindsym $mod+t split toggle
# bindsym $mod+s split vertical
# bindsym $mod+v split horizontal

# Cycle between stacking, tabbed, and last split layout
# bindsym $mod+c layout toggle all

# Make the current focus fullscreen
bindsym $mod+shift+m fullscreen

# Move the currently focused window to the scratchpad
bindsym $mod+Shift+minus move scratchpad
# Show the next scratchpad window or hide the focused scratchpad window.
# If there are multiple scratchpad windows, cycles through them.
bindsym $mod+minus scratchpad show
# }}}

# WORKSPACES {{{
# Workspaces:

# Note: We can use names, with set $ws1 Name
bindsym {
	# Switch to workspace
	$mod+1 workspace number 1
	$mod+2 workspace number 2
	$mod+3 workspace number 3
	$mod+4 workspace number 4
	$mod+5 workspace number 5
	$mod+6 workspace number 6
	$mod+7 workspace number 7
	$mod+8 workspace number 8
	$mod+9 workspace number 9

	# Move focused container to workspace
	$mod+Shift+1 move container to workspace number 1
	$mod+Shift+2 move container to workspace number 2
	$mod+Shift+3 move container to workspace number 3
	$mod+Shift+4 move container to workspace number 4
	$mod+Shift+5 move container to workspace number 5
	$mod+Shift+6 move container to workspace number 6
	$mod+Shift+7 move container to workspace number 7
	$mod+Shift+8 move container to workspace number 8
	$mod+Shift+9 move container to workspace number 9

	# Prior = PageUp, Next = PageDown
	$mod+Prior exec sway-workspace prev
	$mod+Next exec sway-workspace next
	$mod+Shift+Prior exec sway-workspace prev move
	$mod+Shift+Next exec sway-workspace next move
}

# }}}

# MODES {{{
# External display management
set $display ""
# "[m]onitor [l]aptop [b]oth"
mode $display {
	bindsym m output $monitor enable, output $laptop disable, mode "default"
	bindsym l output $monitor disable, output $laptop enable, mode "default"
	bindsym b output $monitor enable, output $laptop enable, mode "default"

	bindsym Return mode "default"
	bindsym Escape mode "default"
}
bindsym $mod+Shift+d mode $display

set $logout ""
# "[l]ock [e]xit [s]hutdown [r]eboot"
mode $logout {
	bindsym l exec swaylock, mode "default"
	bindsym e exec swaymsg exit, mode "default"
	bindsym r exec systemctl reboot, mode "default"
	bindsym s exec systemctl poweroff, mode "default"
	# bindsym S exec systemctl suspend mode "default"
	# bindsym h exec systemctl hibernate, mode "default"

	bindsym Return mode "default"
	bindsym Escape mode "default"
}
bindsym $mod+Shift+x mode $logout

# }}}

# Start Services
exec {
	# Fixes long load time of GTK+ apps
	systemctl --user import-environment
	### Idle configuration
	# Lock screen after 300 seconds of inactivity, then turn off
	# displays after another 30 seconds, and turn screens back on when
	# resumed. It will also lock your screen before your computer goes to sleep.
	swayidle -w \
		timeout 300 'swaylock' \
		timeout 330 'swaymsg "output * dpms off"' \
		timeout 30 'if pgrep swaylock; then swaymsg "output * dpms off"; fi' \
		resume 'swaymsg "output * dpms on"' \
		before-sleep 'swaylock'
	autotiling
	udiskie
	mopidy
	# needed for barify
	mako
}

# When reloading sway while using clamshell mode, the displays may reset (i.e. both displays will be enabled). To stop this:
exec_always "grep -q open /proc/acpi/button/lid/LID/state && swaymsg output $laptop enable || swaymsg output $laptop disable"

include $HOME/.config/sway/config.d/*
